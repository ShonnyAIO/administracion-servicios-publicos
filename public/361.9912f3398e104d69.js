"use strict";(self.webpackChunkkomerzio_front=self.webpackChunkkomerzio_front||[]).push([[361],{8361:(te,u,s)=>{s.r(u),s.d(u,{AgentesModule:()=>ee});var v=s(9808),b=s(2486),f=s(4065),d=s(6696),r=s(5861),g=s(2375),p=s(2340),e=s(5e3),x=s(5331),C=s(2160),h=s(7465),A=s(7553),S=s(6304),y=s(50),w=s(6979),M=s(3185),L=s(3461),T=s(9194),Z=s(68),m=s(3251),E=s(5245);function I(o,l){if(1&o&&e._UZ(0,"app-loader",2),2&o){const t=e.oxw();e.Q6J("statusEvent",t.statusEvent)}}function N(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"app-msj",16),e.NdJ("sendTypingEvent",function(){return e.CHM(t),e.oxw(3).simulateTyping()})("sendEvent",function(a){return e.CHM(t),e.oxw(3).sendMsg(a)})("contactInf",function(a){return e.CHM(t),e.oxw(3).pullItemLabel(a)}),e.qZA()}if(2&o){const t=e.oxw(3);e.Q6J("contactChat",t.contactChat)("chatsDetalle",t.chatsDetalle)}}function O(o,l){if(1&o&&e._UZ(0,"app-empty-chat-box",17),2&o){const t=e.oxw(3);e.Q6J("chatsDetalle",t.chatsDetalle)}}function j(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",5),e.TgZ(1,"div",6),e.TgZ(2,"div",7),e._UZ(3,"app-user-box",8),e.qZA(),e.TgZ(4,"div",9),e.TgZ(5,"app-selected-user-box",10),e.NdJ("soporteFin",function(a){return e.CHM(t),e.oxw(2).pullItemLabel(a)}),e.qZA(),e.qZA(),e.TgZ(6,"div",11),e.TgZ(7,"app-conv-asignadas",12),e.NdJ("obtenerMsj",function(a){return e.CHM(t),e.oxw(2).getBusinessDataFromLogin(a)}),e.qZA(),e.qZA(),e.TgZ(8,"div",13),e.YNc(9,N,1,2,"app-msj",14),e.YNc(10,O,1,1,"ng-template",null,15,e.W1O),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(11),n=e.oxw(2);e.xp6(3),e.Q6J("instanceUserStatus",n.userStatus)("user",n.userAgente),e.xp6(2),e.Q6J("user",n.userInfo)("labelsContact",n.labelsContact)("contactChat",n.contactChat),e.xp6(2),e.Q6J("chatsAsignados",n.contacts),e.xp6(2),e.Q6J("ngIf",n.contactChat)("ngIfElse",t)}}function B(o,l){1&o&&(e.TgZ(0,"mat-icon"),e._uU(1,"supervised_user_circle"),e.qZA())}function P(o,l){1&o&&(e.TgZ(0,"mat-icon"),e._uU(1,"textsms"),e.qZA())}function D(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"app-msj",16),e.NdJ("sendTypingEvent",function(){return e.CHM(t),e.oxw(3).simulateTyping()})("sendEvent",function(a){return e.CHM(t),e.oxw(3).sendMsg(a)})("contactInf",function(a){return e.CHM(t),e.oxw(3).pullItemLabel(a)}),e.qZA()}if(2&o){const t=e.oxw(3);e.Q6J("contactChat",t.contactChat)("chatsDetalle",t.chatsDetalle)}}function F(o,l){if(1&o&&e._UZ(0,"app-empty-chat-box",17),2&o){const t=e.oxw(3);e.Q6J("chatsDetalle",t.chatsDetalle)}}function J(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",18),e.TgZ(1,"div",19),e.TgZ(2,"div",20),e.TgZ(3,"mat-tab-group",21),e.TgZ(4,"mat-tab"),e.YNc(5,B,2,0,"ng-template",22),e.TgZ(6,"div",23),e.TgZ(7,"div",24),e.TgZ(8,"app-conv-asignadas",12),e.NdJ("obtenerMsj",function(a){return e.CHM(t),e.oxw(2).getBusinessDataFromLogin(a)}),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.TgZ(9,"mat-tab"),e.YNc(10,P,2,0,"ng-template",22),e.TgZ(11,"div",23),e.TgZ(12,"div",24),e.TgZ(13,"div",13),e.YNc(14,D,1,2,"app-msj",14),e.YNc(15,F,1,1,"ng-template",null,15,e.W1O),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&o){const t=e.MAs(16),n=e.oxw(2);e.xp6(8),e.Q6J("chatsAsignados",n.contacts),e.xp6(6),e.Q6J("ngIf",n.contactChat)("ngIfElse",t)}}function R(o,l){if(1&o&&(e.TgZ(0,"div"),e._UZ(1,"app-header"),e.YNc(2,j,12,8,"div",3),e.YNc(3,J,17,3,"ng-template",null,4,e.W1O),e.qZA()),2&o){const t=e.MAs(4),n=e.oxw();e.xp6(2),e.Q6J("ngIf",!n.isMobileResolution)("ngIfElse",t)}}let Y=(()=>{class o{constructor(t,n,a,i){this.waService=t,this.cookieService=n,this.globalService=a,this.conversation=i,this.statusEvent={namespace:"Sincronizacion",title:"Sincronizacion detectatada,",data:"espero unos momentos"},this.messageFirebase=null,this.contact={id:null,tipo:"agente"},this.labelName="",this.userAgente={nombre:"Tennis Shop",telefono:"+58 424-2997692",logo:"https://tennisshop.store/wp-content/uploads/2021/02/Logo-TS-160.png"},this.status="",this.loader=!0,this.nroIntentosConexion=0,this.isMobileResolution=!1,localStorage.getItem("sessionWA"),this.userStatus={battery:100},this.loader=!1,console.log("me estoy iniciando"),this.isMobileResolution=a.getIsMobileResolution(),console.log(this.isMobileResolution)}ngOnInit(){var t=this;this.waService.configWA(),this.waService.onStateChanged(),this.waService.getAllLabelEmit(),this.waService.getAllLabels().subscribe(n=>{this.contacts=n,console.log("outEvenLabels: ",n)}),this.userInfo={nombre:"",telefono:"",logo:"../../../assets/init4.png"},this.globalService.authLayoutAgent$.subscribe(n=>{this.agente=n,console.log("agentes",n),this.labelName=n.nombre+" "+n.apellido,console.log("this.labelName: ",this.labelName),this.waService.rooms(n)}),this.waService.emitBatteryDirect(),this.waService.getBattery().subscribe(n=>{String(n).search("ERROR")>=0&&(console.log("entre en search Error"),n=void 0),console.log("battery:",n),this.userStatus={battery:n}}),this.waService.emitMyProfile(),this.waService.getMyProfile().subscribe(n=>{"error"===n.title?this.statusEvent={namespace:"Validador",title:"Intento de conexion detectatada,",data:"el admin de esta empresa todavia no a sincronizado"}:(console.log(n),this.loader=!0,this.userAgente.logo=n.profilePicThumb,this.userAgente.nombre=n.pushname,this.userAgente.telefono="+"+n.me.user,console.log(this.userAgente))}),this.waService.emitOnStateChanged(),this.waService.emitOnNewMessage(),this.waService.onNewMessageAgente().subscribe(function(){var n=(0,r.Z)(function*(a){console.log("outEvenMessage: ",a),t.waService.soundNotification(!0),t.conversation.sendNotificationPush({notification:{title:`Mensaje nuevo de ${a.notifyName}`,body:`${a.text}`,icon:`${a.sender.profilePicThumbObj.eurl}`},to:t.agenteToken}).subscribe(c=>{console.log(c)}),yield t.waService.getAllLabelEmit(),yield t.waService.getAllLabels().subscribe(c=>{t.contacts=c,console.log("outEvenLabels: ",c)}),t.contact.id===a.chatId&&(yield t.waService.emitSendSeen({id:a.chatId}),console.log("mensaje nuevo!"),yield t.waService.emitObtenerMsj({id:a.chatId}),console.log("OBTENER EL NUEVO CHAT"),yield t.obtenerMsg(),setTimeout((0,r.Z)(function*(){yield t.waService.getAllLabelEmit(),yield t.waService.getAllLabels().subscribe(c=>{t.contacts=c,console.log("outEvenLabels: ",c)})}),1e3)),console.log("outEvenMessage",a)});return function(a){return n.apply(this,arguments)}}()),this.waService.onStateChanged().subscribe(n=>{console.log("outEventStateChanged",n),this.status=n}),this.waService.pullItemLabelRooms(),this.waService.onEventPullItemLabelAgente.subscribe(function(){var n=(0,r.Z)(function*(a){t.labelName===a.name&&(yield t.waService.getAllLabelEmit(),yield t.waService.getAllLabels().subscribe(i=>{t.contacts=i,console.log("outEvenLabels: ",i)}),console.log(t.labelName),console.log(t.contact),console.log(a),a.items.length>=1&&a.items.find(i=>{t.contactChat.id===i.id&&(t.userInfo={nombre:"",telefono:"",logo:"../../../assets/init4.png"},console.log("entre xq tiene el mismo id"),t.contactChat=!1,t.chatsDetalle=void 0)}))});return function(a){return n.apply(this,arguments)}}()),this.waService.reasignarChatsAutomaticAgente(),this.waService.onEventReasignacionChats.subscribe(function(){var n=(0,r.Z)(function*(a){"error"!==a.type&&(yield t.waService.getAllLabelEmit(),yield t.waService.getAllLabels().subscribe(i=>{console.log("Ahora es que entre aqui"),t.contacts=i,console.log("outEvenLabels: ",i)}))});return function(a){return n.apply(this,arguments)}}())}requestPermission(){const t=(0,g.KL)();(0,g.LP)(t,{vapidKey:p.N.firebaseConfig.vapidKey}).then(n=>{n?(console.log("Tenemos el token firebase",n),this.agenteToken=n):console.log("No hay token disponible D:")}).catch(n=>{console.log("Hay un error que sucedio",n)})}listen(){const t=(0,g.KL)();(0,g.ps)(t,n=>{console.log("Mensaje recibido",n),this.messageFirebase=n})}getBusinessDataFromLogin(t){var n=this;return(0,r.Z)(function*(){console.log(t);let a={id:t.id};yield n.waService.emitSendSeen(a),yield n.waService.emitObtenerMsj(a),yield n.obtenerMsg(),setTimeout((0,r.Z)(function*(){yield n.waService.getAllLabelEmit(),yield n.waService.getAllLabels().subscribe(i=>{console.log("Ahora es que entre aqui"),n.contacts=i,console.log("outEvenLabels: ",i)})}),1e3),console.log(t),n.contactChat=t,n.userInfo={nombre:t.contact.name||t.contact.pushname||t.contact.formattedName,telefono:"+"+t.lastReceivedKey.remote.user,logo:t.contact.profilePicThumbObj.eurl}})()}sendMsg(t){console.log(t),this.waService.conversationLive(t),this.waService.emitObtenerMsj({id:t.contact}),this.obtenerMsg()}simulateTyping(){console.log("simulateTyping"),this.waService.simulateTyping(this.contact)}pullItemLabel(t){var n=this;console.log(this.labelName),console.log(t),t.labelName=this.labelName,this.waService.pullItemLabel(t),this.waService.onEventPullItemLabel.subscribe(function(){var a=(0,r.Z)(function*(i){console.log(i),yield n.waService.getAllLabelEmit(),yield n.waService.getAllLabels().subscribe(c=>{n.contacts=c,console.log("outEvenLabels: ",c)}),n.labelName===i.name&&(n.chatsDetalle=[],n.userInfo={nombre:"",telefono:"",logo:"../../../assets/init4.png"},n.contactChat=!1,console.log(n.contactChat),yield n.waService.getChatsByLabel(i.name),n.labelsContact=[])});return function(i){return a.apply(this,arguments)}}())}obtenerMsg(){var t=this;this.waService.ObtenerMsg().subscribe(function(){var n=(0,r.Z)(function*(a){let i=a.msg;t.contact={id:i[0].chatId,tipo:"agente"},t.chatsDetalle=i,console.log(a),console.log(a.msg[0]),console.log(t.contact),console.log("outEvenObtenerMsg",t.chatsDetalle),t.labelsContact=a.labels});return function(a){return n.apply(this,arguments)}}())}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(x.o),e.Y36(C.N),e.Y36(h.U),e.Y36(A.O))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-live-conversation"]],decls:3,vars:2,consts:[["loaderBox",""],[4,"ngIf","ngIfElse"],[3,"statusEvent"],["class","row wrapper",4,"ngIf","ngIfElse"],["mobileContainer",""],[1,"row","wrapper"],[1,"container"],[1,"status_box"],[3,"instanceUserStatus","user"],[1,"user_selected_box"],[3,"user","labelsContact","contactChat","soporteFin"],[1,"agentes_box_agent"],[3,"chatsAsignados","obtenerMsj"],[1,"chat_box"],[3,"contactChat","chatsDetalle","sendTypingEvent","sendEvent","contactInf",4,"ngIf","ngIfElse"],["empty",""],[3,"contactChat","chatsDetalle","sendTypingEvent","sendEvent","contactInf"],[3,"chatsDetalle"],[1,"mobile-version"],[1,"row"],[1,"box","mobile-container"],["animationDuration","1000ms"],["mat-tab-label",""],[1,"row","body-lsc-mobile"],[1,"box"]],template:function(t,n){if(1&t&&(e.YNc(0,I,1,1,"ng-template",null,0,e.W1O),e.YNc(2,R,5,2,"div",1)),2&t){const a=e.MAs(1);e.xp6(2),e.Q6J("ngIf",n.loader)("ngIfElse",a)}},directives:[v.O5,S.R,y.G,w.a,M.l,L.W,T.j,Z.B,m.SP,m.uX,m.uD,E.Hw],styles:['.wrapper[_ngcontent-%COMP%]{width:100%;align-items:center;place-content:center;margin:0;padding-top:48px}.container[_ngcontent-%COMP%]{background:white;display:grid;grid-template:repeat(7,.5fr)/repeat(3,.5fr);grid-gap:16px}.status_box[_ngcontent-%COMP%]{width:100%;height:auto;grid-column:1/2;grid-row:1/2;grid-area:statusBox}.user_selected_box[_ngcontent-%COMP%]{grid-column:2/3;grid-row:1/2;grid-area:userSelected;width:100%;height:auto}.agentes_box_admin[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/span 2;grid-area:agentes;width:100%;height:100%}.agentes_box_agent[_ngcontent-%COMP%]{grid-column:1/2;grid-row:2/7;grid-area:agentes;width:100%;height:63vh}.conversation_box[_ngcontent-%COMP%]{grid-column:1/2;grid-row:3/span 7;grid-area:convAsig;width:100%;height:52vh}.chat_box[_ngcontent-%COMP%]{grid-column:2/3;grid-row:2/span 7;grid-area:chatBox;width:100%;height:63vh}@media (max-width: 768px){.chat_box[_ngcontent-%COMP%]{height:83vh!important}}.container[_ngcontent-%COMP%]{grid-template-areas:"statusBox userSelected userSelected" "agentes   chatBox      chatBox" "agentes   chatBox      chatBox" "agentes   chatBox      chatBox" "agentes   chatBox      chatBox" "agentes   chatBox      chatBox" "agentes   chatBox      chatBox"}',".mobile-version[_ngcontent-%COMP%]{display:grid;position:absolute;height:92%;background:whitesmoke;width:100%;overflow:hidden}.mobile-container[_ngcontent-%COMP%]{max-width:100%;width:100%;margin:0}[_nghost-%COMP%]  .mat-tab-label{opacity:1!important}[_nghost-%COMP%]  .mat-tab-label-content{grid-gap:2px;gap:2px;font-weight:600;background:#ffffff;padding:10px;border-radius:25px;color:#161d4b}[_nghost-%COMP%]  .mat-ripple{width:100%;padding:30px}[_nghost-%COMP%]  .mat-ink-bar{background-color:#ffda23!important}[_nghost-%COMP%]  .mat-tab-labels{background:#f5f5f5}.body-lsc-mobile[_ngcontent-%COMP%]{width:100%;display:grid}"]}),o})();var _=s(2843),Q=s(262),U=s(4004),H=s(8113);const G=[{path:"",component:Y,canActivate:[(()=>{class o{constructor(t,n,a){this.userAgentsService=t,this.router=n,this.globalService=a}canActivate(){return localStorage.getItem("session")?this.userAgentsService.validateSession().pipe((0,U.U)(t=>(this.globalService.authLayoutAgentObs(t.msg.payload),t.msg.payload.owner?(console.log("Eres Agente, por lo tanto te quedas en el Modulo"),!0):((0,_._)(()=>"No eres ninguno de ellos e.e xD"),this.router.navigate(["/token-expirado"]),!0))),(0,Q.K)(t=>(0,_._)(()=>{console.log(t.error),t.error.ex.message.includes("invalid")?this.router.navigate(["/acceso-negado"]):this.router.navigate(["/token-expirado"])}))):(this.router.navigate(["/sign-in-agente"]),!0)}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(H.d),e.LFG(d.F0),e.LFG(h.U))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()]}];let z=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[d.Bz.forChild(G)],d.Bz]}),o})();var W=s(1158),K=s(6887),$=s(3696),q=s(3619),V=s(3814),X=s(2802);(0,s(5867).ZF)(p.N.firebaseConfig);let ee=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[v.ez,f.m,z,W.E,K.G,$.Z,q.q,V.y,X.J,b.q]]}),o})()}}]);